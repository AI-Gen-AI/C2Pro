# Coherence Rules v1.0
# Defines the rules for the coherence engine to check for inconsistencies between project documents.

# Sintaxis de la regla:
# <rule_id>:
#   name: <nombre corto para la regla>
#   description: <explicación de lo que comprueba la regla>
#   severity: <critical|high|medium|low>
#   documents: [<doc1>, <doc2>, ...]
#   message: <mensaje de alerta a mostrar si la regla falla>
#   suggested_action: <acción recomendada para que el usuario solucione el problema>

R1:
  name: "Discrepancia en Plazo de Ejecución"
  description: "El plazo de ejecución total definido en el contrato no coincide con la fecha de finalización del cronograma de actividades."
  severity: "critical"
  documents: ["contract", "schedule"]
  message: "El plazo de ejecución del contrato ({contract_duration} días) no coincide con el fin del cronograma ({schedule_end_date})."
  suggested_action: "Ajustar el cronograma para que cumpla con el plazo contractual o negociar una modificación del contrato."

R2:
  name: "Hito Contractual sin Actividad"
  description: "Un hito de entrega o pago definido en el contrato no tiene una actividad o conjunto de actividades correspondiente en el cronograma."
  severity: "high"
  documents: ["contract", "schedule"]
  message: "El hito contractual '{milestone_name}' con fecha {milestone_date} no tiene una actividad de finalización correspondiente en el cronograma."
  suggested_action: "Asegúrese de que todos los hitos contractuales estén representados como tareas o hitos en el cronograma del proyecto."

R3:
  name: "Partida de Presupuesto sin Respaldo Contractual"
  description: "Existe una partida de coste significativa en el presupuesto que no se corresponde con ninguna cláusula, entregable o requisito del contrato."
  severity: "medium"
  documents: ["contract", "budget"]
  message: "La partida del presupuesto '{budget_item_name}' con un coste de {budget_item_cost} no parece tener un respaldo claro en el contrato."
  suggested_action: "Verificar si la partida es necesaria. Si lo es, considere una adenda al contrato para incluirla formalmente."

R4:
  name: "Penalización por Retraso Excesiva"
  description: "La penalización por retraso definida en el contrato es desproporcionadamente alta en comparación con el valor de las partidas de trabajo afectadas."
  severity: "high"
  documents: ["contract", "budget"]
  message: "La penalización por retraso de {penalty_amount}/día parece excesiva en comparación con el coste de las actividades relacionadas."
  suggested_action: "Evaluar el riesgo y renegociar la cláusula de penalización si es posible. Asegurar un control estricto de los plazos."

R5:
  name: "Cronograma Excede Plazo Contractual"
  description: "La fecha de finalización de la última actividad en el cronograma es posterior a la fecha de finalización estipulada en el contrato."
  severity: "critical"
  documents: ["contract", "schedule"]
  message: "El cronograma finaliza el {schedule_end_date}, excediendo la fecha límite del contrato del {contract_end_date}."
  suggested_action: "Revisar la ruta crítica y optimizar la planificación para cumplir con el plazo contractual, o solicitar formalmente una extensión."

R6:
  name: "Discrepancia en el Presupuesto Total"
  description: "La suma total de todas las partidas del presupuesto difiere significativamente (ej. >5%) del precio total acordado en el contrato."
  severity: "medium"
  documents: ["contract", "budget"]
  message: "El presupuesto total ({budget_total}) difiere en un {difference_percentage}% del precio del contrato ({contract_price})."
  suggested_action: "Revisar las partidas del presupuesto para encontrar la discrepancia. Ajustar el presupuesto o el contrato según sea necesario."

R7:
  name: "Actividad del Cronograma sin Presupuesto"
  description: "Una actividad o paquete de trabajo en el cronograma no tiene una partida de costes asociada en el presupuesto."
  severity: "medium"
  documents: ["schedule", "budget"]
  message: "La actividad '{activity_name}' del cronograma no tiene una partida de presupuesto asignada."
  suggested_action: "Asignar costes a todas las actividades del cronograma en el presupuesto para asegurar un control de costes preciso."

R8:
  name: "Hito de Entrega sin Tareas Predecesoras"
  description: "Un hito que representa una entrega parcial importante no tiene una cadena clara de tareas predecesoras que conduzcan a él."
  severity: "low"
  documents: ["schedule"]
  message: "El hito de entrega '{milestone_name}' no tiene actividades predecesoras claramente definidas."
  suggested_action: "Revisar la estructura de dependencias en el cronograma para asegurar que todos los hitos estén lógicamente vinculados a las tareas que los producen."

R9:
  name: "Cláusula de Revisión de Precios sin Partidas"
  description: "El contrato incluye una cláusula de revisión de precios, pero no está claro a qué partidas del presupuesto afecta o cómo se aplicaría."
  severity: "low"
documents: ["contract", "budget"]
  message: "La cláusula de revisión de precios no está vinculada a partidas específicas del presupuesto."
  suggested_action: "Clarificar qué partidas están sujetas a revisión de precios y documentar el mecanismo de aplicación."

R10:
  name: "Plazo de Garantía no Contemplado"
  description: "El contrato estipula un período de garantía post-entrega, pero el cronograma no contempla actividades de soporte o cierre relacionadas con la garantía."
  severity: "medium"
  documents: ["contract", "schedule"]
  message: "El período de garantía de {warranty_period} meses no está reflejado en las fases finales del cronograma."
  suggested_action: "Añadir una fase o actividades post-entrega al cronograma para gestionar el período de garantía y el cierre formal del proyecto."

R11:
  name: "WBS sin Vinculación a Cronograma"
  description: "Un paquete de trabajo (WBS item) no tiene ninguna actividad del cronograma asociada, lo que impide el seguimiento de su progreso temporal."
  severity: "high"
  documents: ["wbs", "schedule"]
  message: "El paquete de trabajo '{wbs_code} - {wbs_name}' no está vinculado a ninguna actividad del cronograma."
  suggested_action: "Asegurar que cada paquete de trabajo en el WBS tenga al menos una actividad correspondiente en el cronograma."

R12:
  name: "WBS sin Asignación Presupuestaria"
  description: "Un paquete de trabajo (WBS item) no tiene ninguna partida de presupuesto asignada, lo que impide el control de sus costes."
  severity: "high"
  documents: ["wbs", "budget"]
  message: "El paquete de trabajo '{wbs_code} - {wbs_name}' no tiene presupuesto asignado."
  suggested_action: "Asignar las partidas de coste correspondientes a cada paquete de trabajo en el WBS para un control presupuestario efectivo."

R13:
  name: "Material del BOM sin Lead Time"
  description: "Un material o equipo en el Bill of Materials (BOM) no tiene un lead time (plazo de entrega) definido, impidiendo calcular la fecha de compra."
  severity: "medium"
  documents: ["bom"]
  message: "El material '{material_name}' en el BOM no tiene un plazo de entrega (lead time) especificado."
  suggested_action: "Investigar y definir los plazos de entrega para todos los materiales del BOM para poder generar un plan de compras preciso."

R14:
  name: "Orden de Material Crítico Retrasada"
  description: "La fecha de compra calculada para un material en la ruta crítica es posterior a la fecha en que se necesita, arriesgando un retraso en todo el proyecto."
  severity: "critical"
  documents: ["bom", "schedule"]
  message: "El material crítico '{material_name}' debe pedirse antes del {order_by_date} para llegar a tiempo, pero la fecha de necesidad es {required_date}."
  suggested_action: "Buscar proveedores alternativos con entregas más rápidas, negociar una entrega acelerada o ajustar el cronograma si es inevitable."

R15:
  name: "BOM Item sin Vínculo a Presupuesto"
  description: "Un material en el BOM no puede ser rastreado hasta una partida en el presupuesto, creando una posible desviación de costes no controlada."
  severity: "high"
  documents: ["bom", "budget"]
  message: "El material '{material_name}' del BOM no está vinculado a ninguna partida del presupuesto."
  suggested_action: "Asegurar que cada material del BOM se corresponda con una partida presupuestaria para un control de costes completo."

R16:
  name: "Coste del BOM vs. Presupuesto"
  description: "La suma de los costes de todos los materiales en el BOM difiere significativamente (ej. >10%) de la suma de las partidas de materiales en el presupuesto."
  severity: "medium"
  documents: ["bom", "budget"]
  message: "El coste total del BOM ({bom_total_cost}) difiere en un {difference_percentage}% del presupuesto de materiales ({budget_materials_cost})."
  suggested_action: "Revisar las cantidades y precios en el BOM y el presupuesto para alinear ambos documentos."

R17:
  name: "Material sin Especificaciones Contractuales"
  description: "Un material clave en el BOM no tiene una especificación técnica o de calidad referenciada en el contrato, creando un riesgo de disputas."
  severity: "low"
  documents: ["bom", "contract"]
  message: "El material '{material_name}' no tiene una especificación técnica clara en el contrato."
  suggested_action: "Añadir una adenda al contrato o un documento de especificaciones técnicas para definir los requisitos de calidad del material."

R18:
  name: "Ruta Crítica Inconsistente"
  description: "La ruta crítica identificada en el WBS (basada en dependencias lógicas) no coincide con la ruta crítica calculada por el software de planificación (ej. MS Project)."
  severity: "high"
  documents: ["wbs", "schedule"]
  message: "La ruta crítica del WBS no coincide con la del cronograma importado."
  suggested_action: "Revisar las dependencias y duraciones de las tareas en el cronograma y el WBS para asegurar que ambas rutas críticas estén alineadas."
